---
created: 2024-07-18 22:40
course-name: Docker & Kubernetes 실전 가이드
instructor: Maximilian Schwarzmüller
section: "섹션 1: 시작하기"
presentation: 
tags:
  - lecture-note
  - "#udemy"
---
## 강의 노트
- 이번 강의에서 사용한 예제 코드는 NodeJS 14.3 이상의 버전에서만 작동하는 코드이다.
- 도커와 컨테이너 없이 로컬에서 실행하려면 NodeJS 사이트에서 최신 버전의 NodeJS를 설치해야 한다.

#### 내 로컬 컴퓨터에서 실행할 때는
- 터미널에 `npm install`을 한다.
- `node app.js`로 실행한다.

#### 도커는
- 도커의 아이디어는 이와 다르다.
- 코드를 컨테이너에서 실행하려고 한다.

- **컨테이너는 항상 이미지를 기반**으로 하기 때문에 
	- 이를 위해  **먼저 이미지를 생성해야 한다**.

> 다음 섹션에서 이미지와 컨테이너 간의 관계를 자세히 알아볼 것이다.

#### 이미지 생성
> 이번 NodeJS 애플리케이션은 포트 3000에서 들어오는 요청을 수신대기하는 웹서버를 생성한다.

- 확장자 없이 `Dockerfile` 파일을 만든다.
	- 여기에 컨테이너를 설정하는 방법을 설명한다.
		- 몇가지 지침(instructions) 을 추가하여 이를 수행
	```dockerfile
	# Dockerfile
	FROM node:14  -> NodeJS 14버전을 기본 이미지로 사용한다.
	
	WORKDIR /app  ->`/app` 디렉토리를 작업 디렉토리로 설정한다.
	
	COPY package.json  -> 현재 디렉토리의 `packet.json` 파일을 작업 디렉토리 `/app` 으로 복사한다.
	
	RUN npm install  -> 애플리케이션에 필요한 모든 종속성을 설치한다.
	
	COPY . .  -> 그런 다음 나머지 파일(코드)를 작업 디렉토리 /app 으로 복사한다.
	
	EXPOSE 3000  -> 컨테이너가 외부와의 통신을 위해 3000 포트를 개방한다. 
	
	CMD [ "node", "app.mjs" ]   -> 컨테이너가 시작할 때 실행될 기본 명령어 설정. NodeJS를 사용하여 app.mjs를 실행
	```

#### 이미지 빌드하기
- 터미널을 연다.
- `docker build .` 을 실행한다.
	- 그러면 Docker 이미지를 빌드한다.
- Docker Desktop에서 도커가 백그라운드에서 실행중인지 확인해본다.
	- 이는 이미 존재하는 노드 환경을 잡아내는 것이다.
- 성공적으로 빌드한 다음,
	- 이 이미지 결과물에 대한 ID를 얻는다.
		- `writing image sha256:3dad473db5ef366a3875c00480db8ec41dd1baed975630719630042bcfa5114f`
			- 뒷 부분의 `3dad473db5ef366a3875c00480db8ec41dd1baed975630719630042bcfa5114f`가 ID 이다. 

#### 이미지를 기반으로 컨테이너 실행
- 터미널에서`docker run <이미지아이디>` 를 하면 되긴 하는데,
	- 이 컨테이너에는 통신하려는 포트가 존재하기 때문에
		- 실제로 실행하려는 컨테이너에 해당 포트를 게시(publish)해야 한다.

- 따라서 `docker run -p 3000:3000 <이미지아이디>`를 실행해야 한다.
	- 로컬 시스템의 로컬 호스트를 사용하여
		- 컨테이너 대신 포트 3000에서 실행되는 애플리케이션에 연결할 수 있다. 
	- **컨테이너와 호스트 운영체제 사이에는 디폴트 연결이 없기** 때문이다.
		- 예를 들어, 컨테이너에서 실행중인 애플리케이션에 **HTTP 요청을 보내려면 통신하려는 컨테이너의 포트를 열어야** 한다.
			- 그렇지 않으면 잠긴 네트워크이므로 외부에서 연결할 수 없다.

- 위 명령어를 실행하면 웹 서버가 실행되기 때문에, `localhost:3000`에 방문할 수 있다.

###### 컨테이너를 중지하려면
- 새 터미널을 연다.
- `docker ps`를 실행한다. 
	- 실행 중인 모든 컨테이너가 나열되는데, 이 컨테이너의 이름(`NAMES`)을 가져와서
		- `docker stop 이름` 을 실행한다. 

#### 도커 덕분에 
- 모든 써드파티 종속성을 설치하기 위한 `npm install`을 실행하지 않아도 웹 서버를 불러올 수 있었다.

---
## 다음 강의 노트 : [[019_이미지,  컨테이너 - 무엇이며, 왜 사용하는가]]
